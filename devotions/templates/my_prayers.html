{% extends "base.html" %}
{% block title %}My Personal Prayers{% endblock %}
{% block content %}
    <div class="page-header">
      <h1>My Personal Prayers</h1>
      <p>Manage your personal prayer intentions here. These prayers will appear on daily devotion pages when the prayer topic matches. This content is only visible to you.</p>
    </div>

    {% if current_user.is_authenticated %}
    <div class="card">
      <h2>Add New Prayer</h2>
      <form action="/add_personal_prayer" method="post">
        <div style="margin-bottom: 10px;">
          <label for="category">Category:</label><br>
          <select id="category" name="category" required class="form-input">
            {% for category in categories %}
            <option value="{{ category }}">{{ category }}</option>
            {% endfor %}
          </select>
        </div>
        <div style="margin-bottom: 10px;">
          <label for="prayer_text">Prayer:</label><br>
          <textarea id="prayer_text" name="prayer_text" rows="3" required maxlength="1000" class="form-input"></textarea>
        </div>
        <div style="margin-bottom: 10px;">
          <label for="for_whom">For Whom (Optional):</label><br>
          <input type="text" id="for_whom" name="for_whom" placeholder="e.g., Mom, Friend, etc." class="form-input">
        </div>
        <button type="submit" class="button">Add Prayer</button>
      </form>
    </div>

    {% for category in categories %}
      {% if prayers_by_cat[category] %}
        <div class="card">
          <h2>{{ category }}</h2>
          <ul style="list-style: none; padding: 0;">
            {% for prayer in prayers_by_cat[category] %}
            <li class="prayer-list-item">
              <!-- Display Mode -->
              <div id="display-{{ prayer.id }}" style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                  {% if prayer.for_whom %}
                    <strong>(For: {{ prayer.for_whom }})</strong>
                  {% endif %}
                  <span>{{ prayer.text }}</span>
                </div>
                <div style="display: flex; gap: 5px;">
                  <button onclick="toggleEdit('{{ prayer.id }}')" class="button" style="padding: 5px 10px; font-size: 0.9em;">Edit</button>
                  <form action="/delete_personal_prayer" method="post" style="margin: 0;">
                    <input type="hidden" name="prayer_id" value="{{ prayer.id }}">
                    <button type="submit" class="button" style="background-color: #e74c3c; padding: 5px 10px; font-size: 0.9em;">Delete</button>
                  </form>
                </div>
              </div>

              <!-- Edit Mode -->
              <div id="edit-{{ prayer.id }}" style="display: none; margin-top: 10px;">
                <form action="/edit_personal_prayer" method="post">
                  <input type="hidden" name="prayer_id" value="{{ prayer.id }}">
                  <div style="margin-bottom: 10px;">
                    <label>Category:</label>
                    <select name="category" required class="form-input">
                      {% for cat in categories %}
                      <option value="{{ cat }}" {% if cat == category %}selected{% endif %}>{{ cat }}</option>
                      {% endfor %}
                    </select>
                  </div>
                  <div style="margin-bottom: 10px;">
                    <label>Prayer:</label>
                    <textarea name="prayer_text" rows="3" required maxlength="1000" class="form-input">{{ prayer.text }}</textarea>
                  </div>
                  <div style="margin-bottom: 10px;">
                    <label>For Whom:</label>
                    <input type="text" name="for_whom" value="{{ prayer.for_whom or '' }}" class="form-input">
                  </div>
                  <button type="submit" class="button" style="padding: 5px 10px; font-size: 0.9em;">Save</button>
                  <button type="button" class="button" onclick="toggleEdit('{{ prayer.id }}')" style="background-color: #95a5a6; padding: 5px 10px; font-size: 0.9em;">Cancel</button>
                </form>
              </div>
            </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    {% endfor %}
    {% else %}
    <div class="card" style="text-align: center;">
      <h2>Start Your Prayer Journey</h2>
      <p>Log in to create and manage your personal prayer list. Your prayers will be securely stored and integrated into your daily devotions.</p>
      <div style="text-align: center; margin-top: 20px;">
          <a href="/login" class="button">Log In / Sign Up</a>
      </div>
    </div>
    {% endif %}

{% endblock %}

{% block extra_js %}
function toggleEdit(prayerId) {
  var displayDiv = document.getElementById('display-' + prayerId);
  var editDiv = document.getElementById('edit-' + prayerId);
  if (displayDiv.style.display === 'none') {
    displayDiv.style.display = 'flex';
    editDiv.style.display = 'none';
  } else {
    displayDiv.style.display = 'none';
    editDiv.style.display = 'block';
  }
}
{% endblock %}
