{% extends "base.html" %}
{% import "_macros.html" as macros %}
{% block title %}Advent Devotion{% endblock %}
{% block content %}
    <div class="page-header">
          <h1>The Advent of Our Lord</h1>
          <h2>{{ devotion_title|safe }}</h2>
          <p>{{ date_str }}</p>
    </div>

    <div style="position: relative; display: flex; justify-content: center; margin-bottom: 30px;">
        <div id="advent-wreath-container">
            <div class="advent-wreath">
              <div class="wreath-base"></div>
              <div class="candle purple-1{% if candle_1_lit %} lit{% endif %}"></div>
              <div class="candle purple-2{% if candle_2_lit %} lit{% endif %}"></div>
              <div class="candle pink{% if candle_3_lit %} lit{% endif %}"></div>
              <div class="candle purple-3{% if candle_4_lit %} lit{% endif %}"></div>
              <div class="candle white{% if candle_5_lit %} lit{% endif %}"></div>
            </div>
        </div>
        <div id="advent-popup" style="top: 70px; left: 50%; transform: translateX(-50%); width: 250px; text-align: center;">
          May the peace and joy of the season fill your heart and home as we await the birth of our Savior.
        </div>
    </div>

    {% call macros.card('Invocation') %}
        <p>
          <span class="rubric"
            >The sign of the cross may be made by all in remembrance of their Baptism.</span
          >
        </p>
        <p>
          In the name of the Father and of the â€  Son and of the Holy Spirit.<br />
          <strong>Amen.</strong>
        </p>
        <p>
          Behold, the King comes:<br />
          <strong>Oh, come, let us worship Him.</strong>
        </p>
    {% endcall %}

    {% call macros.card('Prayer') %}
        {{ macros.format_prayer(config['OTHER_PRAYERS']['lords_prayer']) }}
    {% endcall %}

    {% call macros.card('Reading') %}
        <span class="ref">{{ reading_ref }}</span>
        {{ reading_html|safe }}
    {% endcall %}

    {% call macros.card('Meditation') %}
        {{ meditation_html|safe }}
    {% endcall %}

    {% call macros.card('Prayers') %}
        <p class="subheader"><strong>Prayer of the Day</strong></p>
        {{ daily_prayer_html|safe }}
        <p class="subheader"><strong>Closing Prayer</strong></p>
        <p>
          O almighty and most merciful God, of Your bountiful goodness keep us, we implore You, from
          all things that may hurt us, that we, being ready, both in body and soul, may cheerfully
          accomplish those things that You would have done; through Jesus Christ, Your Son, our
          Lord, who lives and reigns with You and the Holy Spirit, ever one God, world without
          end.

          <strong>Amen</strong>.
        </p>
    {% endcall %}
{% endblock %}

{% block extra_js %}
    const wreathJS = document.getElementById('advent-wreath-container');
    const popupJS = document.getElementById('advent-popup');
    let fadeTimeoutJS;
    if(wreathJS && popupJS) {
        wreathJS.addEventListener('click', () => {
            clearTimeout(fadeTimeoutJS);
            popupJS.style.transition = 'none';
            popupJS.style.opacity = 1;
            popupJS.style.display = 'block';
            void popupJS.offsetWidth;
            popupJS.style.transition = 'opacity 10s ease-out';
            popupJS.style.opacity = 0;
            fadeTimeoutJS = setTimeout(() => {
                popupJS.style.display = 'none';
            }, 10000);
        });
    }
{% endblock %}
