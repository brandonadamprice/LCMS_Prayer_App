{% extends "base.html" %} {% block title %}A Simple Way to Pray{% endblock %} {% block content %}
    <div class="page-header">
      <h1>A Simple Way to Pray</h1>
      <p>Daily prayer, scripture, and devotion.</p>
      <p style="font-style: italic; margin-top: 10px;">"Never think that you are kneeling or standing alone, rather think that the whole of Christendom, all devout Christians, are standing there beside you and you are standing among them in a common, united petition which God cannot disdain." — Martin Luther</p>
    </div>

    <style>
      .card-header-custom {
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        border-bottom: 1px solid #f0f0f0; 
        margin-bottom: 10px; 
        padding-bottom: 10px;
      }
      body.dark-mode .card-header-custom {
        border-bottom-color: #555;
      }
    </style>

    {% if current_user.is_authenticated and current_user.favorites %}
    <div class="card">
      <h2>Favorites</h2>
      {% for fav in current_user.favorites %}
        <a href="{{ fav.path }}" class="button">{{ fav.title }}</a>
      {% endfor %}
    </div>
    {% endif %}

    <div class="card">
      <h2>Suggested Devotions</h2>
      <div id="suggested-devotions-container" style="text-align: center; padding: 10px 0; display: flex; flex-direction: column; gap: 15px; align-items: center;">
          <p style="font-size: 1.2em; margin-bottom: 5px;">It's time for...</p>
          
          <!-- JS will insert time-based devotions here -->
          
          <!-- Seasonal (Server-side rendered) -->
          {% if is_advent %}
            <a href="/advent_devotion" class="button" style="font-size: 1.2em; padding: 15px 30px; background-color: #8e44ad;">Advent Family Devotional</a>
          {% endif %}
          {% if is_new_year %}
            <a href="/new_year_devotion" class="button" style="font-size: 1.2em; padding: 15px 30px;">New Year's Devotion</a>
          {% endif %}
          {% if is_lent %}
            <a href="/lent_devotion" class="button" style="font-size: 1.2em; padding: 15px 30px; background-color: #8e44ad;">Lenten Devotion</a>
          {% endif %}
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
          const now = new Date();
          const hour = now.getHours();
          const day = now.getDay(); // 0 = Sunday, 3 = Wednesday
          const container = document.getElementById('suggested-devotions-container');
          
          // Helper to create button
          function createBtn(name, url, style="") {
              const a = document.createElement('a');
              a.href = url;
              a.className = "button";
              a.style.cssText = "font-size: 1.2em; padding: 15px 30px; background-color: #2980b9;" + style;
              a.textContent = name;
              return a;
          }

          // Insert helper: inserts before the seasonal buttons (which are already in DOM)
          function insertBtn(btn) {
              // Insert after the "It's time for..." paragraph
              const p = container.querySelector('p');
              if (p && p.nextSibling) {
                  container.insertBefore(btn, p.nextSibling);
              } else {
                  container.appendChild(btn);
              }
          }

          // Logic List to prepend in reverse order so they appear correctly
          const buttonsToAdd = [];

          // 1. Primary Time-based Devotion
          let primary = {};
          if (hour >= 5 && hour < 11) {
              primary = {name: "Morning Prayer", url: "/morning_devotion"};
          } else if (hour >= 11 && hour < 15) {
              primary = {name: "Midday Prayer", url: "/midday_devotion"};
          } else if (hour >= 15 && hour < 20) {
              primary = {name: "Evening Prayer", url: "/evening_devotion"};
          } else if (hour >= 0 && hour < 5) {
              primary = {name: "Night Watch", url: "/night_watch_devotion"};
          } else {
              primary = {name: "Close of the Day", url: "/close_of_day_devotion"};
          }
          buttonsToAdd.push(createBtn(primary.name, primary.url));

          // 2. Extended Evening (if Evening or Close of Day)
          if (primary.name === "Evening Prayer" || primary.name === "Close of the Day") {
               buttonsToAdd.push(createBtn("Extended Evening", "/extended_evening_devotion", "background-color: #34495e;"));
          }

          // 3. Mid-week Devotion (Wednesday)
          if (day === 3) { 
              buttonsToAdd.push(createBtn("Mid-Week Devotion", "/mid_week_devotion", "background-color: #8e44ad;"));
          }
          
          const refNode = container.querySelector('p').nextSibling;
          buttonsToAdd.forEach(btn => {
             container.insertBefore(btn, refNode); 
          });
      });
    </script>

    <div class="card">
        <h2>Daily Readings</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <a href="/daily_lectionary" class="button" style="flex: 1; min-width: 200px;">Daily Lectionary</a>
            <a href="/bible_in_a_year" class="button" style="flex: 1; min-width: 200px;">Bible in a Year</a>
        </div>
    </div>

    <div class="card">
        <h2>Prayer Community</h2>
        <p>Join others in prayer or submit your own request.</p>
        <div style="text-align: center;">
            <a href="/prayer_wall" class="button">Go to Prayer Wall</a>
        </div>
    </div>

    <p class="mobile-nav" style="text-align: center; margin-top: 30px; color: #7f8c8d;">
        <em>Tap the menu (☰) above to access all devotions, calendar, and settings.</em>
    </p>

    <div style="text-align: center; margin-top: 20px" id="github-link">
      <a
        href="https://github.com/brandonadamprice/LCMS_Prayer_App/tree/main/devotions"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg"
          alt="GitHub Repository"
          title="GitHub Repository"
        />
      </a>
    </div>
{% endblock %}
