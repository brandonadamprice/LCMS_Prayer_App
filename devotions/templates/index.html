{% extends "base.html" %} {% block title %}A Simple Way to Pray{% endblock %} {% block content %}
    <div class="page-header">
      <h1>A Simple Way to Pray</h1>
      <p>Daily prayer, scripture, and devotion.</p>
      <p style="font-style: italic; margin-top: 10px;">"Never think that you are kneeling or standing alone, rather think that the whole of Christendom, all devout Christians, are standing there beside you and you are standing among them in a common, united petition which God cannot disdain." — Martin Luther</p>
    </div>

    <style>
      .card-header-custom {
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        border-bottom: 1px solid #f0f0f0; 
        margin-bottom: 10px; 
        padding-bottom: 10px;
      }
      body.dark-mode .card-header-custom {
        border-bottom-color: #555;
      }
    </style>

    <div class="card">
      <h2>Favorites</h2>
      {% if current_user.is_authenticated %}
        {% if current_user.favorites %}
          {% for fav in current_user.favorites %}
            <a href="{{ fav.path }}" class="button">{{ fav.title }}</a>
          {% endfor %}
        {% else %}
          <p>Click the favorite button in a devotion to add it to your favorites.</p>
        {% endif %}
      {% else %}
        <p><a href="/login">Sign in</a> or <a href="/register">register</a> to add to your favorites.</p>
      {% endif %}
    </div>

    <div class="card">
      <h2>Suggested Devotions</h2>
      <div id="suggested-devotions-container" style="text-align: center; padding: 10px 0; display: flex; flex-direction: column; gap: 15px; align-items: center;">
          <p style="font-size: 1.2em; margin-bottom: 5px;">It's time for...</p>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
          const now = new Date();
          const hour = now.getHours();
          const day = now.getDay(); // 0 = Sunday, 3 = Wednesday
          const container = document.getElementById('suggested-devotions-container');

          // Seasonal Flags (Server-side)
          const isAdvent = {{ is_advent|tojson }};
          const isNewYear = {{ is_new_year|tojson }};
          const isLent = {{ is_lent|tojson }};
          
          // Helper to create button
          function createBtn(name, url, style="") {
              const a = document.createElement('a');
              a.href = url;
              a.className = "button";
              a.style.cssText = "font-size: 1.2em; padding: 15px 30px; background-color: #2980b9;" + style;
              a.textContent = name;
              return a;
          }

          // 1. Primary Time-based Devotion
          let primary = {};
          if (hour >= 5 && hour < 11) {
              primary = {name: "Morning Prayer", url: "/morning_devotion"};
          } else if (hour >= 11 && hour < 15) {
              primary = {name: "Midday Prayer", url: "/midday_devotion"};
          } else if (hour >= 15 && hour < 20) {
              primary = {name: "Evening Prayer", url: "/evening_devotion"};
          } else if (hour >= 0 && hour < 5) {
              primary = {name: "Night Watch", url: "/night_watch_devotion"};
          } else {
              primary = {name: "Close of the Day", url: "/close_of_day_devotion"};
          }
          const primaryBtn = createBtn(primary.name, primary.url);
          
          // 2. Identify Secondary Buttons
          const secondaryBtns = [];

          // Seasonal
          if (isAdvent) {
              secondaryBtns.push(createBtn("Advent Family Devotional", "/advent_devotion", "background-color: #8e44ad; font-size: 1em; padding: 10px 20px;"));
          }
          if (isNewYear) {
              secondaryBtns.push(createBtn("New Year's Devotion", "/new_year_devotion", "font-size: 1em; padding: 10px 20px;"));
          }
          if (isLent) {
              secondaryBtns.push(createBtn("Lenten Devotion", "/lent_devotion", "background-color: #8e44ad; font-size: 1em; padding: 10px 20px;"));
          }

          // Extended Evening (if Evening or Close of Day)
          if (primary.name === "Evening Prayer" || primary.name === "Close of the Day") {
               secondaryBtns.push(createBtn("Extended Evening", "/extended_evening_devotion", "background-color: #34495e; font-size: 1em; padding: 10px 20px;"));
          }

          // Mid-week Devotion (Wednesday)
          if (day === 3) { 
              secondaryBtns.push(createBtn("Mid-Week Devotion", "/mid_week_devotion", "background-color: #8e44ad; font-size: 1em; padding: 10px 20px;"));
          }
          
          // 3. Append to DOM
          container.appendChild(primaryBtn);

          // Add Secondary Row
          if (secondaryBtns.length > 0) {
              const row = document.createElement('div');
              row.style.cssText = "display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; width: 100%; margin-top: 10px;";
              secondaryBtns.forEach(btn => row.appendChild(btn));
              container.appendChild(row);
          }
      });
    </script>

    <div class="card">
        <h2>Daily Readings</h2>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
            <a href="/daily_lectionary" class="button" style="flex: 1; min-width: 200px;">Daily Lectionary</a>
            <a href="/bible_in_a_year" class="button" style="flex: 1; min-width: 200px;">Bible in a Year</a>
        </div>
    </div>

    <div class="card">
        <h2>Prayer Community</h2>
        <p>Join others in prayer or submit your own request.</p>
        <div style="text-align: center;">
            <a href="/prayer_wall" class="button">Go to Prayer Wall</a>
        </div>
    </div>

    <p class="mobile-nav" style="text-align: center; margin-top: 30px; color: #7f8c8d;">
        <em>Tap the menu (☰) above to access all devotions, calendar, and settings.</em>
    </p>

    <div style="text-align: center; margin-top: 20px" id="github-link">
      <a
        href="https://github.com/brandonadamprice/LCMS_Prayer_App/tree/main/devotions"
        target="_blank"
        rel="noopener noreferrer"
      >
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/9/91/Octicons-mark-github.svg"
          alt="GitHub Repository"
          title="GitHub Repository"
        />
      </a>
    </div>
{% endblock %}
