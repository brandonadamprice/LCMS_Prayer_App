{% extends "base.html" %}
{% import "_macros.html" as macros with context %}

{% block title %}Short Prayers for Specific Situations{% endblock %}

{% block content %}
    <div class="page-header">
      <h1>Short Prayers for Specific Situations</h1>
      <p>Select a situation to view a prayer for reflection, or use the search bar to filter.</p>
      <p style="font-style: italic; margin-top: 10px;">"Pray, and let God worry." â€” Martin Luther</p>
    </div>

    <div style="margin-bottom: 20px;">
      <input type="text" id="prayer-search" onkeyup="filterPrayers()" placeholder="Search situations..." style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box;">
    </div>

    <!-- Easter Egg -->
    <div id="packers-egg" style="display: none;">
      {% call macros.card('A Prayer for the Packers', collapsed=False) %}
        <p>O Lord, we bring before You our heavy hearts. We confess our pride when being up 21-3 at the half against the Bears, and we lament the bitterness of losing 31-27 and being eliminated from the playoffs. Grant us the grace to endure this defeat and the patience to wait for next season. Amen.</p>
      {% endcall %}
    </div>

    <div id="prayer-cards">
    {% for item in situations %}
      {% call macros.card(item.situation, collapsed=True) %}
        <p>{{ item.prayer }}</p>
      {% endcall %}
    {% endfor %}
    </div>
{% endblock %}

{% block extra_js %}
function filterPrayers() {
  const input = document.getElementById('prayer-search');
  const filter = input.value.toLowerCase();
  const prayerCardsDiv = document.getElementById('prayer-cards');
  const cards = prayerCardsDiv.getElementsByClassName('card');
  const packersEgg = document.getElementById('packers-egg');

  // Easter Egg Logic
  if (filter === 'packers') {
      if (packersEgg) packersEgg.style.display = 'block';
  } else {
      if (packersEgg) packersEgg.style.display = 'none';
  }

  for (let i = 0; i < cards.length; i++) {
    const card = cards[i];
    const header = card.getElementsByTagName('h2')[0];
    if (header) {
      const txtValue = header.textContent || header.innerText;
      if (txtValue.toLowerCase().indexOf(filter) > -1) {
        card.style.display = "";
      } else {
        card.style.display = "none";
      }
    }
  }
}

document.addEventListener('DOMContentLoaded', () => {
    if (window.location.hash === '#packers') {
        const packersEgg = document.getElementById('packers-egg');
        const input = document.getElementById('prayer-search');
        if(packersEgg) {
            packersEgg.style.display = 'block';
            // Set the search value so the user knows why it's there
            input.value = "Packers"; 
            // Trigger filter to hide others
            filterPrayers(); 
            packersEgg.scrollIntoView();
        }
    }
});
{% endblock %}
