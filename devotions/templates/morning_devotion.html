{% extends parent_template|default("base.html") %}
{% import "_macros.html" as macros with context %}
{% block title %}Morning Devotion{% endblock %}
{% block head %}
<link rel="preload" as="image" href="{{ url_for('static', filename='banner_morning.jpg') }}">
{% endblock %}
{% block content %}
    <div class="page-header" style="--bg-image: url('{{ url_for('static', filename='banner_morning.jpg', _external=True) }}');">
      <h1>Morning Devotion</h1>
      <p>
        {{ date_str }}<br />
        <span style="color: #7f8c8d">Lectionary Day: {{ key }}</span>
      </p>
      <p style="font-style: italic; margin-top: 10px;">"I have so much to do that I shall spend the first three hours in prayer." — Martin Luther</p>
    </div>

    {% call macros.card('Opening') %}
        <p>
          <span class="rubric"
            >The sign of the cross may be made by all in remembrance of their Baptism.</span
          >
        </p>
        <p>
          In the name of the Father and of the † Son and of the Holy Spirit.<br />
          <strong> Amen.</strong>
        </p>
        <p>
          In the morning, O Lord, You hear my voice;<br />
          <strong>in the morning I prepare a sacrifice for You and watch.</strong>
          <span class="versicle-ref">Psalm 5:3</span>
        </p>
        <p>
          My mouth is filled with Your praise,<br />
          <strong>and with Your glory all the day.</strong>
          <span class="versicle-ref">Psalm 71:8</span>
        </p>
        <p>
          O Lord, open my lips,<br />
          <strong>and my mouth will declare Your praise.</strong>
          <span class="versicle-ref">Psalm 51:15</span>
        </p>
        {{ macros.format_prayer(config['OTHER_PRAYERS']['gloria_patri']) }}
    {% endcall %}

    {% call macros.card('Psalmody') %}
        <span class="ref" id="ref-psalm">{{ psalm_ref }}</span>
        <p id="text-psalm">{{ psalm_text|safe }}</p>
        {% if psalm_options %}
        <button class="button picker-toggle-button" onclick="togglePicker(this, 'psalm')">Select Psalm</button>
        <div id="picker-psalm" class="item-picker">
            {% for p in psalm_options %}
            <button class="button picker-select-button" onclick="selectRef('{{ p }}', 'psalm')">{{ p }}</button>
            {% endfor %}
        </div>
        {% endif %}
        {{ macros.format_prayer(config['OTHER_PRAYERS']['gloria_patri']) }}
    {% endcall %}

    {{ macros.reading_card(reading_ref, reading_text, reading_options, daily_lectionary_readings, lectionary_texts, bible_in_a_year_reading) }}

    {% call macros.card('Creed') %}
        {% if is_trinity_sunday %}
            <div id="athanasian-creed">
                <p class="rubric">The Athanasian Creed is traditionally recited on Trinity Sunday.</p>
                {{ macros.format_prayer(config['OTHER_PRAYERS']['athanasian_creed']) }}
                <button class="button" onclick="showApostlesCreed()">Switch to Apostles' Creed</button>
            </div>
            <div id="apostles-creed" style="display: none;">
                {{ macros.format_prayer(config['OTHER_PRAYERS']['apostles_creed']) }}
                <button class="button" onclick="showAthanasianCreed()">Switch to Athanasian Creed</button>
            </div>
        {% else %}
            {{ macros.format_prayer(config['OTHER_PRAYERS']['apostles_creed']) }}
        {% endif %}
    {% endcall %}

    {% call macros.card('Prayers') %}
        {{ macros.format_prayer(config['OTHER_PRAYERS']['lords_prayer']) }}
        <hr />
        <p><em>(You may offer your own prayers at this time)</em></p>
        {{ macros.personal_prayers_toggle(all_personal_prayers) }}
        <hr />
        <p class="subheader"><strong>Concluding Prayer</strong></p>
        {{ macros.format_prayer(concluding_prayer) }}
        <hr />
        {{ macros.format_prayer(luthers_morning_prayer) }}
    {% endcall %}

    {{ macros.prayer_complete_button('morning') }}

    {% call macros.card('Conclusion') %}
        <p>
          Let us bless the Lord.<br />
          <strong>Thanks be to God.</strong>
        </p>
        <p><span class="rubric">Then go joyfully to your work.</span></p>
    {% endcall %}
{% endblock %}

{% block extra_js %}
    window.suppressDefaultArt = true;
    {{ macros.reading_mode_js(bible_in_a_year_reading.day_number) }}

    document.addEventListener('DOMContentLoaded', async () => {
        const readingRef = "{{ reading_ref }}";
        const theme = "Resurrection"; // Morning theme
        try {
            const response = await fetch(`/api/lectionary/art?ref=${encodeURIComponent(readingRef)}&theme=${encodeURIComponent(theme)}`);
            const data = await response.json();
            if (data && data.image_url) {
                displayBackgroundArt(data);
            }
        } catch (e) {
            console.error("Failed to fetch background art", e);
        }
    });
{% endblock %}
