{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Liturgical Calendar{% endblock %}

{% block content %}
    <div class="page-header">
      <h1>Liturgical Calendar</h1>
      <p>View the church year seasons, colors, and feast days.</p>
    </div>

    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <a href="/liturgical_calendar?year={{ prev_year }}&month={{ prev_month }}" class="button">&laquo; Prev</a>
            <h2 style="border-bottom: none; margin: 0;">{{ month_name }} {{ year }}</h2>
            <a href="/liturgical_calendar?year={{ next_year }}&month={{ next_month }}" class="button">Next &raquo;</a>
        </div>

        <div class="calendar-wrapper">
            <div class="calendar-grid">
                <div class="calendar-header">Sun</div>
                <div class="calendar-header">Mon</div>
                <div class="calendar-header">Tue</div>
                <div class="calendar-header">Wed</div>
                <div class="calendar-header">Thu</div>
                <div class="calendar-header">Fri</div>
                <div class="calendar-header">Sat</div>

                {% for week in calendar_data %}
                    {% for day in week %}
                        <div class="calendar-day {{ day.color }} {% if day.is_today %}today{% endif %} {% if not day.is_current_month %}other-month{% endif %}" onclick="openDayModal('{{ day.date_obj.strftime('%A, %B %d, %Y') }}', '{{ day.full_name|replace("'", "\\'") }}', '{{ day.color_name }}', '{{ day.season }}')">
                            <span class="day-number">{{ day.day }}</span>
                            {% if day.key != day.day ~ " " ~ month_name[:3] and day.key != (day.day < 10 and "0" ~ day.day or day.day) ~ " " ~ month_name[:3] %}
                                <div class="feast-name">{{ day.key }}</div>
                            {% endif %}
                            <div class="liturgical-color-dot" title="{{ day.color_name }}"></div>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
        
        <div style="margin-top: 20px; text-align: center; font-size: 0.9em;">
            <span class="legend-item white"><span class="liturgical-color-dot"></span> White</span>
            <span class="legend-item violet"><span class="liturgical-color-dot"></span> Violet</span>
            <span class="legend-item rose"><span class="liturgical-color-dot"></span> Rose</span>
            <span class="legend-item red"><span class="liturgical-color-dot"></span> Red</span>
            <span class="legend-item green"><span class="liturgical-color-dot"></span> Green</span>
            <span class="legend-item black"><span class="liturgical-color-dot"></span> Black</span>
        </div>
    </div>

    <!-- Day Details Modal -->
    <div id="day-modal" class="modal" onclick="closeDayModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <span class="close-modal" onclick="closeDayModal()">&times;</span>
            <h2 id="modal-date" style="margin-top: 0;"></h2>
            <p id="modal-feast" style="font-size: 1.2em; font-weight: bold; margin: 15px 0;"></p>
            <p><strong>Season:</strong> <span id="modal-season"></span></p>
            <p><strong>Color:</strong> <span id="modal-color"></span></p>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
function openDayModal(dateStr, feastName, colorName, seasonName) {
    document.getElementById('modal-date').textContent = dateStr;
    
    // If the feast name looks like a date (e.g. "05 Jan" or "5 Jan"), display something generic or nothing
    // We check if it matches D MMM or DD MMM format approximately.
    // Actually, in the template we suppress it if it matches day + month[:3].
    // Here we can just display it. If it's just "05 Jan", the user sees that.
    // Or we can check if feastName contains the date.
    
    // Simple heuristic: if feastName is very short and contains digits, it might be just a date label.
    // However, keeping it simple is better. The python code sets key to display_name which defaults to date key if no feast.
    document.getElementById('modal-feast').textContent = feastName;
    
    document.getElementById('modal-season').textContent = seasonName;
    document.getElementById('modal-color').textContent = colorName;
    document.getElementById('day-modal').classList.add('visible');
}

function closeDayModal(event) {
    document.getElementById('day-modal').classList.remove('visible');
}
{% endblock %}
