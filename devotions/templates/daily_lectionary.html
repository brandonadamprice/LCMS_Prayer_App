{% extends "base.html" %}
{% import "_macros.html" as macros with context %}

{% block title %}Daily Lectionary{% endblock %}

{% block content %}
    <div class="page-header">
      <h1>Daily Lectionary</h1>
      <p>
        {{ date_str }}<br />
        <span style="color: #7f8c8d">Lectionary Day: {{ key }}</span>
      </p>
    </div>

    {% call macros.card('Old Testament Reading') %}
        <span class="ref">{{ ot_ref }}</span>
        <p>{{ ot_text|safe }}</p>
    {% endcall %}

    {% call macros.card('New Testament Reading') %}
        <span class="ref">{{ nt_ref }}</span>
        <p>{{ nt_text|safe }}</p>
    {% endcall %}

    {{ macros.prayer_complete_button() }}

{% endblock %}

{% block extra_js %}
    window.suppressDefaultArt = true;
    document.addEventListener('DOMContentLoaded', () => {
        const ntRef = "{{ nt_ref }}";

        async function tryFetchArt() {
            if (ntRef && ntRef !== "Reading not found") {
                try {
                    console.log(`Fetching art for NT ref: ${ntRef}`);
                    const response = await fetch(`/api/lectionary/art?ref=${encodeURIComponent(ntRef)}`);
                    const data = await response.json();
                    console.log('Art API Response:', data);
                    
                    if (data.image_url) {
                        displayBackgroundArt(data);
                        return;
                    } else {
                        console.log('No art returned from API.');
                    }
                } catch (e) {
                    console.error("Error fetching NT art", e);
                }
            } else {
                console.log('No NT ref to search for.');
            }
        }

        tryFetchArt();
    });
{% endblock %}
